---
import { marked } from "marked";
import Layout from "../../layouts/Layout.astro"
import Navbar from "../../components/Navbar.astro"
import Footer from "../../components/Footer.astro"

interface Studycase {
  attributes: {
    title: string,
    slug: string
    desc: string,
    content: string,
    sinceFrom: string,
    sinceTo: string,
    office: string,
    partner: string,
    picture: {
      data: {
        attributes: {
          url: string
        }
      }
    },
    partnerImg: {
      data: {
        attributes: {
          url: string
        }
      }
    }
  }
}

export async function getStaticPaths() {
  const query = "populate[picture][fields][0]=url&populate[partnerImg][fields][0]=url";
  let url = import.meta.env.STRAPI_URL + "/api/studycases";

  const data = await fetch(url + "?" + query).then(response => response.json()).catch((err) => err);
  return data.data.map((studycase: Studycase) => {
    return {
      params: { slug: studycase.attributes.slug },
      props: { studycase },
    }
  });
}

const { studycase } = Astro.props as { studycase: Studycase };
const { title, picture, content, partner, partnerImg, sinceFrom, sinceTo, office } = studycase.attributes;
---

<Layout>
  <Navbar />
  <main class="container mx-auto pb-20 pt-40 space-y-12">
    <a href="/studycase" class="text-lg text-sky-600 hover:text-sky-700 duration-300 transition-colors">&larr; Back to Study Case</a>
    <hr>
    <h1 class="text-5xl">{title}</h1>
    <img src={import.meta.env.STRAPI_URL + picture.data.attributes.url} alt={title} class="rounded-2xl">
    <article>
      <ul class="flex flex-col lg:flex-row justify-between gap-12">
        <li class="flex-1">
          <p>Partner:</p>
          <img src={import.meta.env.STRAPI_URL + partnerImg.data.attributes.url} alt={partner}>
        </li>
        <li class="flex-1">
          <p>Since:</p>
          <p>{sinceFrom}&mdash;{sinceTo}</p>
        </li>
        <li class="flex-1">
          <p>Office:</p>
          <p>{office}</p>
        </li>
      </ul>
      <div class="prose mt-12" set:html={marked.parse(content)}></div>
    </article>
  </main>
  <Footer />
</Layout>
